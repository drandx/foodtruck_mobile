// This file has been autogenerated from a class added in the UI designer.

using System;

using MonoTouch.Foundation;
using MonoTouch.UIKit;
using FlyoutNavigation;
using MonoTouch.Dialog;
using DInteractive.Core;

namespace DInteractive.iOS
{
	public partial class MainPageController : UIViewController
	{
		public static FlyoutNavigationController navigation;
		readonly CategoriesModel categoriesModel = (CategoriesModel)DependencyInjectionWrapper.Instance.ServiceContainer ().GetService (typeof(CategoriesModel));
		readonly UserModel loginViewModel = (UserModel)DependencyInjectionWrapper.Instance.ServiceContainer ().GetService (typeof(UserModel));

		public MainPageController (IntPtr handle) : base (handle)
		{
		}

		public async override void ViewDidLoad ()
		{
			base.ViewDidLoad ();

			try {
				if((!CategoriesModel.Loaded) && (loginViewModel.UserType.Equals(UserType.CONSUMER)))
					await categoriesModel.GetCategories ();
			} catch (Exception exc) {
				Console.WriteLine ("Problems loading categories " + exc.Message);
			}
			FlyoutNavigationController LateralBar = new FlyoutNavigationController();

			if (loginViewModel.UserType.Equals(UserType.CONSUMER)) {
				LateralBar = new FlyoutNavigationController {//this will create a new instance of the FlyoutComponent
					NavigationRoot = new RootElement ("Menu") { //Here we create the root of the alements
						new Section () {//with this code we create Sections
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_home.png"), true),
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_perfil.png"), false),
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_categorias.png"), false),
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_servicios_activos.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_historial.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_ranking.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_sugerencias.png"), false),
						},
					},
					ViewControllers = new [] {//here we link Controllers to the elements on the sections
						this.Storyboard.InstantiateViewController ("HomeLogoController") as UIViewController,//here we create the instances for the Controllers
						this.Storyboard.InstantiateViewController ("ProfileController") as UIViewController,//here we create the instances for the Controllers
						this.Storyboard.InstantiateViewController ("CategoryController") as UIViewController,
						this.Storyboard.InstantiateViewController ("SupplierAgendaNavigation") as UIViewController,
						//this.Storyboard.InstantiateViewController ("HistorialController") as UIViewController,
						//this.Storyboard.InstantiateViewController ("RankingController") as UIViewController,
						//this.Storyboard.InstantiateViewController ("SugerenciasController") as UIViewController,
					}
				};
			}
			else if(loginViewModel.UserType.Equals(UserType.SUPPLIER))
			{
				LateralBar = new FlyoutNavigationController {//this will create a new instance of the FlyoutComponent
					NavigationRoot = new RootElement ("Menu") { //Here we create the root of the alements
						new Section () {//with this code we create Sections
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_home.png"), true),
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_perfil.png"), false),
							new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_agenda.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_sugerencias.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_historico.png"), false),
							//new MyImageStringElement ("", UIImage.FromFile ("images/btn_menu_ranking.png"), false),
						},
					},
					ViewControllers = new [] {//here we link Controllers to the elements on the sections
						this.Storyboard.InstantiateViewController ("HomeLogoController") as UIViewController,//here we create the instances for the Controllers
						this.Storyboard.InstantiateViewController ("ProfileController") as UIViewController,//here we create the instances for the Controllers
						this.Storyboard.InstantiateViewController ("SupplierAgendaNavigation") as UIViewController,
						//this.Storyboard.InstantiateViewController ("SugerenciasController") as UIViewController,
						//this.Storyboard.InstantiateViewController ("HistorialController") as UIViewController,
						//this.Storyboard.InstantiateViewController ("RankingController") as UIViewController,
					}
				};

			}


			//LateralBar.NavigationTableView.BackgroundView = new UIImageView (UIImage.FromBundle ("images/Background-Party.png"));
			UIColor bgColor = UIColor.FromRGB (0, 167, 229);
			LateralBar.NavigationTableView.BackgroundColor = bgColor;
			LateralBar.NavigationTableView.SeparatorColor = UIColor.Clear;

			LateralBar.ToggleMenu ();
			View.AddSubview (LateralBar.View);
			navigation = LateralBar;

		}

		public override void ViewDidDisappear (bool animated)
		{
			base.ViewDidDisappear (animated);
		}
	}
}
